function code = CAgenerator_L5IQ(sv,modulation)

%==========================================================================

% 

%--------------------------------------------------------------------------

% Author: Raul Onrubia (onrubia [at] tsc.upc.es)

% Copyright 2014 Raul Onrubia

% License: GNU GPLv3

%==========================================================================



    I5is = [0 1 0 1 0 1 1 1 0 0 1 0 0
    1 1 0 0 0 0 0 1 1 0 1 0 1
    0 1 0 0 0 0 0 0 0 1 0 0 0
    1 0 1 1 0 0 0 1 0 0 1 1 0
    1 1 1 0 1 1 1 0 1 0 1 1 1
    0 1 1 0 0 1 1 1 1 1 0 1 0
    1 0 1 0 0 1 0 0 1 1 1 1 1
    1 0 1 1 1 1 0 1 0 0 1 0 0
    1 1 1 1 1 0 0 1 0 1 0 1 1
    0 1 1 1 1 1 1 0 1 1 1 1 0
    0 0 0 0 1 0 0 1 1 1 0 1 0
    1 1 1 0 0 1 1 1 1 1 0 0 1
    0 0 0 1 1 1 0 0 1 1 1 0 0
    0 1 0 0 0 0 0 1 0 0 1 1 1
    0 1 1 0 1 0 1 0 1 1 0 1 0
    0 0 0 1 1 1 1 0 0 1 0 0 1
    0 1 0 0 1 1 0 0 0 1 1 1 1
    1 1 1 1 0 0 0 0 1 1 1 1 0
    1 1 0 0 1 0 0 0 1 1 1 1 1
    0 1 1 0 1 0 1 1 0 1 1 0 1
    0 0 1 0 0 0 0 0 0 1 0 0 0
    1 1 1 0 1 1 1 1 0 1 1 1 1
    1 0 0 0 0 1 1 1 1 1 1 1 0
    1 1 0 0 0 1 0 1 1 0 1 0 0
    1 1 0 1 0 0 1 1 0 1 1 0 1
    1 0 1 0 1 1 0 0 1 0 1 1 0
    0 1 0 1 0 1 1 0 1 1 1 1 0
    0 1 1 1 1 0 1 0 1 0 1 1 0
    0 1 0 1 1 1 1 1 0 0 0 0 1
    1 0 0 0 0 1 0 1 1 0 1 1 1
    0 0 0 1 0 1 0 0 1 1 1 1 0
    0 0 0 0 0 1 0 1 1 1 0 0 1
    1 1 0 1 0 1 0 0 0 0 0 0 1
    1 1 0 1 1 1 1 1 1 1 0 0 1
    1 1 1 1 0 1 1 0 1 1 1 0 0
    1 0 0 1 0 1 1 0 0 1 0 0 0
    0 0 1 1 0 1 0 0 1 0 0 0 0
    0 1 0 1 1 0 0 0 0 0 1 1 0
    1 0 0 1 0 0 1 1 0 0 1 0 1
    1 1 0 0 1 1 1 0 0 1 0 1 0
    0 1 1 1 0 1 1 0 1 1 0 0 1
    0 0 1 1 1 0 1 1 0 1 1 0 0
    0 0 1 1 0 1 1 1 1 1 0 1 0
    1 0 0 1 0 1 1 0 1 0 0 0 1
    1 0 0 1 0 1 0 1 1 1 1 1 1
    0 1 1 1 0 0 0 1 1 1 1 0 1
    0 0 0 0 0 0 1 0 0 0 1 0 0
    1 0 0 0 1 0 1 0 1 0 0 0 1
    0 0 1 1 0 1 0 0 0 1 0 0 1
    1 0 0 0 1 1 1 1 1 0 0 0 1
    1 0 1 1 1 0 0 1 0 1 0 0 1
    0 1 0 0 1 0 1 0 1 1 0 1 0
    0 0 0 0 0 0 1 0 0 0 0 1 0
    0 1 1 0 0 0 1 1 0 1 1 1 0
    0 0 0 0 0 1 1 0 0 1 1 1 0
    1 1 1 0 1 1 1 0 1 1 1 1 0
    0 0 0 1 0 0 0 0 1 0 0 1 1
    0 0 0 0 0 1 0 1 0 0 0 0 1
    0 1 0 0 0 0 1 1 0 0 0 0 1
    0 1 0 0 1 0 1 0 0 1 0 0 1
    0 0 1 1 1 1 0 0 1 1 1 1 0
    1 0 1 1 0 0 0 1 1 0 0 0 1
    0 1 0 1 1 1 1 0 0 1 0 1 1];


    Q5is = [1 0 0 1 0 1 1 0 0 1 1 0 0
    0 1 0 0 0 1 1 1 1 0 1 1 0
    1 1 1 1 0 0 0 1 0 0 0 1 1
    0 0 1 1 1 0 1 1 0 1 0 1 0
    0 0 1 1 1 1 0 1 1 0 0 1 0
    0 1 0 1 0 1 0 1 0 1 0 0 1
    1 1 1 1 1 1 0 0 0 0 0 0 1
    0 1 1 0 1 0 1 1 0 1 0 0 0
    1 0 1 1 1 0 1 0 0 0 0 1 1
    0 0 1 0 0 1 0 0 0 0 1 1 0
    0 0 0 1 0 0 0 0 0 0 1 0 1
    0 1 0 1 0 1 1 0 0 0 1 0 1
    0 1 0 0 1 1 0 1 0 0 1 0 1
    1 0 1 0 0 0 0 1 1 1 1 1 1
    1 0 1 1 1 1 0 0 0 1 1 1 1
    1 1 0 1 0 0 1 0 1 1 1 1 1
    1 1 1 0 0 1 1 0 0 1 0 0 0
    1 0 1 1 0 1 1 1 0 0 1 0 0
    0 0 1 1 0 0 1 0 1 1 0 1 1
    1 1 0 0 0 0 1 1 1 0 0 0 1
    0 1 1 0 1 1 0 0 1 0 0 0 0
    0 0 1 0 1 1 0 0 0 1 1 1 0
    1 0 0 0 1 0 1 1 1 1 1 0 1
    0 1 1 0 1 1 1 1 1 0 0 1 1
    0 1 0 0 0 1 0 0 1 1 0 1 1
    0 1 0 1 0 1 0 1 1 1 1 0 0
    1 0 0 0 0 1 1 1 1 1 0 1 0
    1 1 1 1 1 0 1 0 0 0 0 1 0
    0 1 0 1 0 0 0 1 0 0 1 0 0
    1 0 0 0 0 0 1 1 1 1 0 0 1
    0 1 0 1 1 1 1 1 0 0 1 0 1
    1 0 0 1 0 0 0 1 0 1 0 1 0
    1 0 1 1 0 0 1 0 0 0 1 0 0
    1 1 1 1 0 0 1 0 0 0 1 0 0
    0 1 1 0 0 1 0 1 1 0 0 1 1
    0 0 1 1 1 1 0 1 0 1 1 1 1
    0 0 1 0 0 1 1 0 1 0 0 0 1
    1 1 1 1 1 1 0 0 1 1 1 0 1
    0 1 0 1 0 1 0 0 1 1 1 1 1
    1 0 0 0 1 1 0 1 0 1 0 1 0
    0 0 1 0 1 1 1 1 0 0 1 0 0
    1 0 1 1 0 0 0 1 0 0 0 0 0
    0 0 1 1 0 0 1 0 1 1 0 0 1
    1 0 0 0 1 0 0 1 0 1 0 0 0
    0 0 0 0 0 0 1 1 1 1 1 1 0
    0 0 0 0 0 0 0 0 1 0 0 1 1
    0 1 0 1 1 1 0 0 1 1 1 1 0
    0 0 0 1 0 0 1 0 0 0 1 1 1
    0 0 1 1 1 1 0 0 0 0 1 0 0
    0 1 0 0 1 0 1 0 1 1 1 0 0
    0 0 1 0 1 0 0 0 1 1 1 1 1
    1 1 0 1 1 1 0 0 1 1 0 0 1
    0 0 1 1 1 1 1 1 0 1 1 1 1
    1 1 0 0 1 0 0 1 1 0 1 1 1
    1 0 0 1 0 0 1 1 0 0 1 1 0
    0 1 0 0 0 1 0 0 1 1 0 0 1
    0 0 0 0 0 0 0 0 0 1 0 1 1
    0 0 0 0 0 0 1 1 0 1 1 1 1
    0 1 0 1 1 0 1 1 0 1 1 1 1
    0 1 0 0 1 0 0 0 0 1 1 0 1
    1 1 0 1 1 0 0 1 0 1 0 1 1
    1 0 1 0 1 1 1 0 0 0 1 0 0
    0 0 1 0 0 0 1 1 0 1 0 0 1];

    n=13;
    L=10230;

    % XA LFSR: x^13+x^12+x^10+x^10+1

    XAs=[0 0 0 0 0 0 0 0 1 1 0 1 1]; % 1 .... x^13
    XBIs=[1 0 1 1 0 1 1 1 0 0 0 1 1];
    XBQs=[1 0 1 1 0 1 1 1 0 0 0 1 1];

    XA=ones(1,n);
    XBI = I5is(sv,:);
    XBQ = Q5is(sv,:);

    XI= zeros(1,ceil(L*1));	%initialization vector for XI
    XQ = zeros(1,ceil(L*1)); %initialization vector for XQ

    decode=[1 1 1 1 1 1 1 1 1 1 1 0 1]; 


    for ii=1:L

        XI(ii)=mod(XA(n)+XBI(n),2);

        XQ(ii)=mod(XA(n)+XBQ(n),2);

        if (isequal(XA,decode))
            XA = ones(1,n);
        else
            XA=[mod(sum(XA.*XAs),2) XA(1:n-1)];
        end

        XBI=[mod(sum(XBI.*XBIs),2) XBI(1:n-1)];
        XBQ=[mod(sum(XBQ.*XBQs),2) XBQ(1:n-1)];    

        XA_aux(ii) = XA(end);
        XBI_aux(ii) = XBI(end);
        XBQ_aux(ii) = XBQ(end);

    end

    XI = 2*XI-1;
    XQ = 2*XQ-1;

    if modulation == 'L5I'
        code = XI;
    else
        code = XQ;
    end

end